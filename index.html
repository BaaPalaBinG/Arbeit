<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Urenregistratie v3</title>
<style>
  body { font-family: system-ui; background:#f2f2f2; margin:0; padding:20px; }
  .card { background:white; padding:14px; border-radius:10px; margin-bottom:16px; }
  .form-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:10px; }
  input, select { width:100%; padding:6px; border-radius:6px; border:1px solid #ccc; }
  .entry-list { display:flex; flex-direction:column; gap:6px; }
  .entry-item {
    padding:4px 6px; border-radius:6px; border:1px solid #ccc;
    display:flex; align-items:center; gap:10px; background:#fafafa;
    font-size:0.78rem;
  }
  .entry-left { display:flex; align-items:center; gap:8px; flex:1; }
  .entry-main { display:flex; gap:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .entry-right { white-space:nowrap; }
  .pill { background:#e8f0ff; padding:1px 5px; border-radius:999px; }
</style>
</head>
<body>

<h2>Uren & Kilometer Registratie</h2>

<div class="card">
  <div class="form-grid">
    <div>
      <label>Datum</label>
      <input id="date" type="date">
    </div>
    <div>
      <label>Tijd van</label>
      <input id="timeFrom" type="time">
    </div>
    <div>
      <label>Tijd tot</label>
      <input id="timeTo" type="time">
    </div>
    <div>
      <label>Uren (auto)</label>
      <input id="hours" type="number" step="0.25">
    </div>
    <div>
      <label>Kilometers</label>
      <input id="km" type="number">
    </div>
    <div>
      <label>Opdrachtgever</label>
      <input id="client" list="clientList">
      <datalist id="clientList"></datalist>
    </div>
    <div>
      <label>Locatie / Job</label>
      <input id="job">
    </div>
  </div>

  <button id="save">Opslaan</button>
  <button id="copyLast">Kopieer laatste</button>
</div>

<div class="card">
  <h3>Laatste registraties</h3>
  <div id="entryList" class="entry-list"></div>
</div>

<script>
const STORAGE_KEY = "urenKm_v3";
const CLIENT_KEY = "urenKmClients_v3";
let entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
let clients = JSON.parse(localStorage.getItem(CLIENT_KEY) || "[]");

const dateEl = document.getElementById("date");
const timeFromEl = document.getElementById("timeFrom");
const timeToEl = document.getElementById("timeTo");
const hoursEl = document.getElementById("hours");
const kmEl = document.getElementById("km");
const clientEl = document.getElementById("client");
const jobEl = document.getElementById("job");
const clientList = document.getElementById("clientList");

function renderClients(){
  clientList.innerHTML = "";
  clients.forEach(c=>{
    let o=document.createElement("option");
    o.value=c;
    clientList.appendChild(o);
  });
}

function autoSetDate(){
  if(!dateEl.value){
    const today = new Date().toISOString().split("T")[0];
    dateEl.value = today;
  }
}

function computeHours(){
  const f=timeFromEl.value, t=timeToEl.value;
  if(!f || !t) return;
  let [fh,fm]=f.split(":").map(Number);
  let [th,tm]=t.split(":").map(Number);
  let start=fh*60+fm, end=th*60+tm;
  if(end<=start) end+=1440;
  hoursEl.value = Math.round(((end-start)/60)*100)/100;
}

function renderList(){
  const box = document.getElementById("entryList");
  box.innerHTML="";
  entries.slice().reverse().forEach(e=>{
    const div=document.createElement("div");
    div.className="entry-item";
    div.innerHTML = `
      <div class="entry-left">
        <input type="checkbox" data-id="${e.id}">
        <div class="entry-main">
          <span class="pill">${e.date}</span>
          <span>${e.timeFrom} - ${e.timeTo}</span>
          <span>${e.client} â€¢ ${e.job}</span>
        </div>
      </div>
      <div class="entry-right">${e.hours}h ${e.km}km</div>
    `;
    box.appendChild(div);
  });
}

document.getElementById("save").onclick = ()=>{
  computeHours();
  autoSetDate();

  const e = {
    id: Date.now(),
    date: dateEl.value,
    timeFrom: timeFromEl.value,
    timeTo: timeToEl.value,
    hours: hoursEl.value,
    km: kmEl.value,
    client: clientEl.value,
    job: jobEl.value
  };
  entries.push(e);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));

  if(!clients.includes(e.client)){
    clients.push(e.client);
    localStorage.setItem(CLIENT_KEY, JSON.stringify(clients));
    renderClients();
  }

  renderList();
};

document.getElementById("copyLast").onclick = ()=>{
  if(!entries.length) return;
  const e = entries[entries.length-1];
  const txt = `${e.date}
${e.timeFrom} - ${e.timeTo}
${e.hours} h.   ${e.km} km
${e.client}, ${e.job}`;
  navigator.clipboard.writeText(txt);
  alert("Gekopieerd!");
};

timeFromEl.onchange = ()=>{ autoSetDate(); computeHours(); };
timeToEl.onchange = ()=>{ autoSetDate(); computeHours(); };

renderClients();
renderList();
</script>
</body>
</html>
